<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/finance/libs/katex/katex.min.css"> <link rel=stylesheet  href="/finance/libs/highlight/styles/github.min.css"> <link rel=stylesheet  href="/finance/css/franklin.css"> <link rel=stylesheet  href="/finance/css/hypertext.css"> <link rel=icon  href="/finance/assets/favicon.png"> <title>Optimal Stopping with Log Prices for Mean Reversion</title> <header> <h1 style="color:#283747">Finance</h1> <nav> <a href="/finance/" class=current >Tags</a> | <a href="/finance/blog/" >Notes</a> <hr/> </nav> </header> <div class=franklin-content ><h1 id=optimal_stopping_with_log_prices_for_mean_reversion ><a href="#optimal_stopping_with_log_prices_for_mean_reversion" class=header-anchor >Optimal Stopping with Log Prices for Mean Reversion</a></h1> <h2 id=why_log_prices ><a href="#why_log_prices" class=header-anchor >Why Log Prices?</a></h2> <p><strong>The Problem:</strong> Raw prices don&#39;t normalize for price level. A &#36;1 move means different things for a &#36;10 stock vs a &#36;1000 stock.</p> <p><strong>The Solution:</strong> Work in log space where returns are additive and symmetric.</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><msub><mi>r</mi><mi>log</mi><mo>⁡</mo></msub><mo>=</mo><mi>ln</mi><mo>⁡</mo><mrow><mo fence=true >(</mo><mfrac><msub><mi>P</mi><mi>t</mi></msub><msub><mi>P</mi><mn>0</mn></msub></mfrac><mo fence=true >)</mo></mrow></mrow><annotation encoding="application/x-tex">r_{\log} = \ln\left(\frac{P_t}{P_0}\right)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.7167em;vertical-align:-0.2861em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class=mtight >l</span><span class=mtight >o</span><span class=mtight  style="margin-right:0.01389em;">g</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:2.4em;vertical-align:-0.95em;"></span><span class=mop >ln</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.3603em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span></span></span></span></span> <p><strong>Key Properties:</strong></p> <ul> <li><p><strong>Additive:</strong> <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ln</mi><mo>⁡</mo><mo stretchy=false >(</mo><msub><mi>P</mi><mi>t</mi></msub><mi mathvariant=normal >/</mi><msub><mi>P</mi><mn>0</mn></msub><mo stretchy=false >)</mo><mo>=</mo><mi>ln</mi><mo>⁡</mo><msub><mi>P</mi><mi>t</mi></msub><mo>−</mo><mi>ln</mi><mo>⁡</mo><msub><mi>P</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">\ln(P_t/P_0) = \ln P_t - \ln P_0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mop >ln</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord >/</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.8444em;vertical-align:-0.15em;"></span><span class=mop >ln</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.8444em;vertical-align:-0.15em;"></span><span class=mop >ln</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p> <li><p><strong>Symmetric:</strong> A 10\&#37; gain and 10\&#37; loss have equal magnitude in log space</p> <li><p><strong>Stationary:</strong> Statistical properties don&#39;t depend on price level</p> </ul> <h2 id=mean_reversion_in_log_space ><a href="#mean_reversion_in_log_space" class=header-anchor >Mean Reversion in Log Space</a></h2> <p>Mean reversion is naturally modeled as an <strong>Ornstein-Uhlenbeck &#40;OU&#41; process</strong> in log prices:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>d</mi><mo stretchy=false >(</mo><mi>ln</mi><mo>⁡</mo><msub><mi>P</mi><mi>t</mi></msub><mo stretchy=false >)</mo><mo>=</mo><mi>θ</mi><mo stretchy=false >(</mo><mi>μ</mi><mo>−</mo><mi>ln</mi><mo>⁡</mo><msub><mi>P</mi><mi>t</mi></msub><mo stretchy=false >)</mo><mi>d</mi><mi>t</mi><mo>+</mo><mi>σ</mi><mi>d</mi><msub><mi>W</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">d(\ln P_t) = \theta(\mu - \ln P_t)dt + \sigma dW_t</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class=mopen >(</span><span class=mop >ln</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mopen >(</span><span class="mord mathnormal">μ</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mop >ln</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span><span class="mord mathnormal">d</span><span class="mord mathnormal">t</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="mord mathnormal">d</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span> <p><strong>Parameters:</strong></p> <ul> <li><p><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span></span> &#61; mean reversion speed &#40;how fast it reverts&#41;</p> <li><p><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi></mrow><annotation encoding="application/x-tex">\mu</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">μ</span></span></span></span> &#61; long-run equilibrium level &#40;log price&#41;</p> <li><p><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>σ</mi></mrow><annotation encoding="application/x-tex">\sigma</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span></span></span></span> &#61; volatility</p> <li><p><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">W_t</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> &#61; Brownian motion</p> </ul> <p><strong>Intuition:</strong> When <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ln</mi><mo>⁡</mo><msub><mi>P</mi><mi>t</mi></msub><mo>&lt;</mo><mi>μ</mi></mrow><annotation encoding="application/x-tex">\ln P_t &lt; \mu</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8444em;vertical-align:-0.15em;"></span><span class=mop >ln</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >&lt;</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">μ</span></span></span></span> &#40;price below average&#41;, the drift is positive and pulls it back up. When <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ln</mi><mo>⁡</mo><msub><mi>P</mi><mi>t</mi></msub><mo>&gt;</mo><mi>μ</mi></mrow><annotation encoding="application/x-tex">\ln P_t &gt; \mu</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8444em;vertical-align:-0.15em;"></span><span class=mop >ln</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >&gt;</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">μ</span></span></span></span>, drift is negative.</p> <p><strong>Discrete-time approximation:</strong></p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>ln</mi><mo>⁡</mo><msub><mi>P</mi><mrow><mi>t</mi><mo>+</mo><mi mathvariant=normal >Δ</mi><mi>t</mi></mrow></msub><mo>=</mo><mi>ln</mi><mo>⁡</mo><msub><mi>P</mi><mi>t</mi></msub><mo>+</mo><mi>θ</mi><mo stretchy=false >(</mo><mi>μ</mi><mo>−</mo><mi>ln</mi><mo>⁡</mo><msub><mi>P</mi><mi>t</mi></msub><mo stretchy=false >)</mo><mi mathvariant=normal >Δ</mi><mi>t</mi><mo>+</mo><mi>σ</mi><msqrt><mrow><mi mathvariant=normal >Δ</mi><mi>t</mi></mrow></msqrt><mo>⋅</mo><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">\ln P_{t+\Delta t} = \ln P_t + \theta(\mu - \ln P_t)\Delta t + \sigma\sqrt{\Delta t} \cdot \epsilon</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.9028em;vertical-align:-0.2083em;"></span><span class=mop >ln</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">Δ</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2083em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.8444em;vertical-align:-0.15em;"></span><span class=mop >ln</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mopen >(</span><span class="mord mathnormal">μ</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mop >ln</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span><span class=mord >Δ</span><span class="mord mathnormal">t</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:1.04em;vertical-align:-0.0645em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.9755em;"><span class=svg-align  style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=mord  style="padding-left:0.833em;"><span class=mord >Δ</span><span class="mord mathnormal">t</span></span></span><span style="top:-2.9355em;"><span class=pstrut  style="height:3em;"></span><span class=hide-tail  style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702 c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14 c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54 c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10 s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429 c69,-144,104.5,-217.7,106.5,-221 l0 -0 c5.3,-9.3,12,-14,20,-14 H400000v40H845.2724 s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7 c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z M834 80h400000v40h-400000z'/></svg></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.0645em;"><span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >⋅</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal">ϵ</span></span></span></span></span> <p>where <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϵ</mi><mo>∼</mo><mi>N</mi><mo stretchy=false >(</mo><mn>0</mn><mo separator=true >,</mo><mn>1</mn><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">\epsilon \sim N(0,1)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal">ϵ</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >∼</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class=mopen >(</span><span class=mord >0</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord >1</span><span class=mclose >)</span></span></span></span>.</p> <h2 id=optimal_stopping_in_log_space ><a href="#optimal_stopping_in_log_space" class=header-anchor >Optimal Stopping in Log Space</a></h2> <p>The value function becomes:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>V</mi><mo stretchy=false >(</mo><mi>ln</mi><mo>⁡</mo><msub><mi>P</mi><mi>t</mi></msub><mo stretchy=false >)</mo><mo>=</mo><mi>max</mi><mo>⁡</mo><mrow><mo fence=true >{</mo><mi>ln</mi><mo>⁡</mo><msub><mi>P</mi><mi>t</mi></msub><mo>−</mo><mi>ln</mi><mo>⁡</mo><msub><mi>P</mi><mn>0</mn></msub><mo separator=true >,</mo><mspace width=1em /><mi>E</mi><mo stretchy=false >[</mo><mi>V</mi><mo stretchy=false >(</mo><mi>ln</mi><mo>⁡</mo><msub><mi>P</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy=false >)</mo><mo>∣</mo><mi>ln</mi><mo>⁡</mo><msub><mi>P</mi><mi>t</mi></msub><mo stretchy=false >]</mo><mo>−</mo><mi>c</mi><mo fence=true >}</mo></mrow></mrow><annotation encoding="application/x-tex">V(\ln P_t) = \max\left\{\ln P_t - \ln P_0, \quad E[V(\ln P_{t+1}) \mid \ln P_t] - c\right\}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class=mopen >(</span><span class=mop >ln</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mop >max</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;">{</span><span class=mop >ln</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mop >ln</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:1em;"></span><span class=mspace  style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=mopen >[</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class=mopen >(</span><span class=mop >ln</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2083em;"><span></span></span></span></span></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mop >ln</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >]</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span><span class="mord mathnormal">c</span><span class="mclose delimcenter" style="top:0em;">}</span></span></span></span></span></span> <p><strong>Decision rule:</strong> Exit when current profit exceeds expected future profit &#40;accounting for holding costs&#41;.</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mtext>Exit if: </mtext><mspace width=1em /><mi>ln</mi><mo>⁡</mo><msub><mi>P</mi><mi>t</mi></msub><mo>−</mo><mi>ln</mi><mo>⁡</mo><msub><mi>P</mi><mn>0</mn></msub><mo>≥</mo><mi>E</mi><mo stretchy=false >[</mo><mi>V</mi><mo stretchy=false >(</mo><mi>ln</mi><mo>⁡</mo><msub><mi>P</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy=false >)</mo><mo>∣</mo><mi>ln</mi><mo>⁡</mo><msub><mi>P</mi><mi>t</mi></msub><mo stretchy=false >]</mo><mo>−</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">\text{Exit if: } \quad \ln P_t - \ln P_0 \geq E[V(\ln P_{t+1}) \mid \ln P_t] - c</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord text"><span class=mord >Exit if: </span></span><span class=mspace  style="margin-right:1em;"></span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mop >ln</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.8444em;vertical-align:-0.15em;"></span><span class=mop >ln</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >≥</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=mopen >[</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class=mopen >(</span><span class=mop >ln</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2083em;"><span></span></span></span></span></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mop >ln</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >]</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal">c</span></span></span></span></span> <p><strong>Why this works better:</strong></p> <ol> <li><p>Mean reversion dynamics are <strong>linear</strong> in log space</p> <li><p>Conditional expectations are easy to compute from OU process</p> <li><p>Probabilities are <strong>stationary</strong> &#40;don&#39;t depend on price level&#41;</p> </ol> <h2 id=concrete_example ><a href="#concrete_example" class=header-anchor >Concrete Example</a></h2> <p><strong>Setup:</strong></p> <ul> <li><p>Stock normally trades at <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ln</mi><mo>⁡</mo><mi>P</mi><mo>=</mo><mn>4.605</mn></mrow><annotation encoding="application/x-tex">\ln P = 4.605</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6944em;"></span><span class=mop >ln</span><span class=mspace  style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.6444em;"></span><span class=mord >4.605</span></span></span></span> &#40;<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>e</mi><mn>4.605</mn></msup><mo>≈</mo><mi mathvariant=normal >$</mi><mn>100</mn></mrow><annotation encoding="application/x-tex">e^{4.605} ≈ \$100</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8141em;"></span><span class=mord ><span class="mord mathnormal">e</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">4.605</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >≈</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.8056em;vertical-align:-0.0556em;"></span><span class=mord >$100</span></span></span></span>&#41;</p> <li><p>Currently at <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ln</mi><mo>⁡</mo><mi>P</mi><mo>=</mo><mn>4.500</mn></mrow><annotation encoding="application/x-tex">\ln P = 4.500</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6944em;"></span><span class=mop >ln</span><span class=mspace  style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.6444em;"></span><span class=mord >4.500</span></span></span></span> &#40;<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>e</mi><mn>4.500</mn></msup><mo>≈</mo><mi mathvariant=normal >$</mi><mn>90</mn></mrow><annotation encoding="application/x-tex">e^{4.500} ≈ \$90</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8141em;"></span><span class=mord ><span class="mord mathnormal">e</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">4.500</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >≈</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.8056em;vertical-align:-0.0556em;"></span><span class=mord >$90</span></span></span></span>&#41; — oversold&#33;</p> <li><p>Mean reversion speed: <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi><mo>=</mo><mn>2.0</mn></mrow><annotation encoding="application/x-tex">\theta = 2.0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.6444em;"></span><span class=mord >2.0</span></span></span></span> per hour</p> <li><p>Volatility: <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>σ</mi><mo>=</mo><mn>0.15</mn></mrow><annotation encoding="application/x-tex">\sigma = 0.15</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.6444em;"></span><span class=mord >0.15</span></span></span></span> per hour</p> <li><p>Time step: <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >Δ</mi><mi>t</mi><mo>=</mo><mn>0.1</mn></mrow><annotation encoding="application/x-tex">\Delta t = 0.1</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6833em;"></span><span class=mord >Δ</span><span class="mord mathnormal">t</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.6444em;"></span><span class=mord >0.1</span></span></span></span> hours &#40;6 minutes&#41;</p> </ul> <p><strong>Expected log price in 6 minutes:</strong></p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>E</mi><mo stretchy=false >[</mo><mi>ln</mi><mo>⁡</mo><msub><mi>P</mi><mrow><mi>t</mi><mo>+</mo><mn>0.1</mn></mrow></msub><mo stretchy=false >]</mo><mo>=</mo><mn>4.500</mn><mo>+</mo><mn>2.0</mn><mo>×</mo><mo stretchy=false >(</mo><mn>4.605</mn><mo>−</mo><mn>4.500</mn><mo stretchy=false >)</mo><mo>×</mo><mn>0.1</mn><mo>=</mo><mn>4.500</mn><mo>+</mo><mn>0.021</mn><mo>=</mo><mn>4.521</mn></mrow><annotation encoding="application/x-tex">E[\ln P_{t+0.1}] = 4.500 + 2.0 \times (4.605 - 4.500) \times 0.1 = 4.500 + 0.021 = 4.521</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=mopen >[</span><span class=mop >ln</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">0.1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2083em;"><span></span></span></span></span></span></span><span class=mclose >]</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.7278em;vertical-align:-0.0833em;"></span><span class=mord >4.500</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.7278em;vertical-align:-0.0833em;"></span><span class=mord >2.0</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >×</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class=mord >4.605</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord >4.500</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >×</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.6444em;"></span><span class=mord >0.1</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.7278em;vertical-align:-0.0833em;"></span><span class=mord >4.500</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.6444em;"></span><span class=mord >0.021</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.6444em;"></span><span class=mord >4.521</span></span></span></span></span> <p>In price terms: <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>e</mi><mn>4.521</mn></msup><mo>≈</mo><mi mathvariant=normal >$</mi><mn>91.91</mn></mrow><annotation encoding="application/x-tex">e^{4.521} ≈ \$91.91</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8141em;"></span><span class=mord ><span class="mord mathnormal">e</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">4.521</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >≈</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.8056em;vertical-align:-0.0556em;"></span><span class=mord >$91.91</span></span></span></span></p> <p><strong>At current position <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ln</mi><mo>⁡</mo><mi>P</mi><mo>=</mo><mn>4.55</mn></mrow><annotation encoding="application/x-tex">\ln P = 4.55</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6944em;"></span><span class=mop >ln</span><span class=mspace  style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.6444em;"></span><span class=mord >4.55</span></span></span></span> &#40;<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mi mathvariant=normal >$</mi><mn>94.63</mn></mrow><annotation encoding="application/x-tex">\approx \$94.63</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.4831em;"></span><span class=mrel >≈</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.8056em;vertical-align:-0.0556em;"></span><span class=mord >$94.63</span></span></span></span>&#41;:</strong></p> <p>Current profit: <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4.55</mn><mo>−</mo><mn>4.50</mn><mo>=</mo><mn>0.05</mn></mrow><annotation encoding="application/x-tex">4.55 - 4.50 = 0.05</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.7278em;vertical-align:-0.0833em;"></span><span class=mord >4.55</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.6444em;"></span><span class=mord >4.50</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.6444em;"></span><span class=mord >0.05</span></span></span></span> log points <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mn>5.13</mn><mi mathvariant=normal >%</mi></mrow><annotation encoding="application/x-tex">\approx 5.13\%</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.4831em;"></span><span class=mrel >≈</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.8056em;vertical-align:-0.0556em;"></span><span class=mord >5.13%</span></span></span></span></p> <p>Expected profit if holding another 6 minutes:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>E</mi><mo stretchy=false >[</mo><mi>ln</mi><mo>⁡</mo><msub><mi>P</mi><mrow><mi>t</mi><mo>+</mo><mn>0.1</mn></mrow></msub><mo stretchy=false >]</mo><mo>=</mo><mn>4.55</mn><mo>+</mo><mn>2.0</mn><mo>×</mo><mo stretchy=false >(</mo><mn>4.605</mn><mo>−</mo><mn>4.55</mn><mo stretchy=false >)</mo><mo>×</mo><mn>0.1</mn><mo>=</mo><mn>4.561</mn></mrow><annotation encoding="application/x-tex">E[\ln P_{t+0.1}] = 4.55 + 2.0 \times (4.605 - 4.55) \times 0.1 = 4.561</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=mopen >[</span><span class=mop >ln</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">0.1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2083em;"><span></span></span></span></span></span></span><span class=mclose >]</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.7278em;vertical-align:-0.0833em;"></span><span class=mord >4.55</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.7278em;vertical-align:-0.0833em;"></span><span class=mord >2.0</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >×</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class=mord >4.605</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord >4.55</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >×</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.6444em;"></span><span class=mord >0.1</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.6444em;"></span><span class=mord >4.561</span></span></span></span></span> <p>Expected profit: <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4.561</mn><mo>−</mo><mn>4.50</mn><mo>=</mo><mn>0.061</mn></mrow><annotation encoding="application/x-tex">4.561 - 4.50 = 0.061</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.7278em;vertical-align:-0.0833em;"></span><span class=mord >4.561</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.6444em;"></span><span class=mord >4.50</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.6444em;"></span><span class=mord >0.061</span></span></span></span> log points <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mn>6.29</mn><mi mathvariant=normal >%</mi></mrow><annotation encoding="application/x-tex">\approx 6.29\%</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.4831em;"></span><span class=mrel >≈</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.8056em;vertical-align:-0.0556em;"></span><span class=mord >6.29%</span></span></span></span></p> <p><strong>Decision:</strong> If holding cost <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo>&lt;</mo><mn>0.011</mn></mrow><annotation encoding="application/x-tex">c &lt; 0.011</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">c</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >&lt;</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.6444em;"></span><span class=mord >0.011</span></span></span></span> &#40;≈1.1\&#37;&#41;, keep holding&#33;</p> <h2 id=symmetry_correction_example ><a href="#symmetry_correction_example" class=header-anchor >Symmetry Correction Example</a></h2> <p><strong>Common mistake:</strong> Setting symmetric percentage stops/targets in price space.</p> <p>Stock at &#36;100, trader sets:</p> <ul> <li><p>Target: &#36;110 &#40;&#43;10\&#37;&#41;</p> <li><p>Stop: &#36;90 &#40;−10\&#37;&#41;</p> </ul> <p><strong>In log space:</strong></p> <ul> <li><p>Target: <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ln</mi><mo>⁡</mo><mo stretchy=false >(</mo><mn>110</mn><mi mathvariant=normal >/</mi><mn>100</mn><mo stretchy=false >)</mo><mo>=</mo><mn>0.0953</mn></mrow><annotation encoding="application/x-tex">\ln(110/100) = 0.0953</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mop >ln</span><span class=mopen >(</span><span class=mord >110/100</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.6444em;"></span><span class=mord >0.0953</span></span></span></span></p> <li><p>Stop: <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ln</mi><mo>⁡</mo><mo stretchy=false >(</mo><mn>90</mn><mi mathvariant=normal >/</mi><mn>100</mn><mo stretchy=false >)</mo><mo>=</mo><mo>−</mo><mn>0.1054</mn></mrow><annotation encoding="application/x-tex">\ln(90/100) = -0.1054</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mop >ln</span><span class=mopen >(</span><span class=mord >90/100</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.7278em;vertical-align:-0.0833em;"></span><span class=mord >−</span><span class=mord >0.1054</span></span></span></span></p> </ul> <p><strong>Asymmetric&#33;</strong> You&#39;re risking 10.54\&#37; to gain 9.53\&#37;.</p> <p><strong>Corrected symmetric setup:</strong></p> <ul> <li><p>Target: <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ln</mi><mo>⁡</mo><mo stretchy=false >(</mo><mn>100</mn><mo stretchy=false >)</mo><mo>+</mo><mn>0.10</mn><mo>=</mo><mn>4.705</mn><mo>⇒</mo><mi>P</mi><mo>=</mo><mi mathvariant=normal >$</mi><mn>110.52</mn></mrow><annotation encoding="application/x-tex">\ln(100) + 0.10 = 4.705 \Rightarrow P = \$110.52</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mop >ln</span><span class=mopen >(</span><span class=mord >100</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.6444em;"></span><span class=mord >0.10</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.6444em;"></span><span class=mord >4.705</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >⇒</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.8056em;vertical-align:-0.0556em;"></span><span class=mord >$110.52</span></span></span></span></p> <li><p>Stop: <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ln</mi><mo>⁡</mo><mo stretchy=false >(</mo><mn>100</mn><mo stretchy=false >)</mo><mo>−</mo><mn>0.10</mn><mo>=</mo><mn>4.505</mn><mo>⇒</mo><mi>P</mi><mo>=</mo><mi mathvariant=normal >$</mi><mn>90.48</mn></mrow><annotation encoding="application/x-tex">\ln(100) - 0.10 = 4.505 \Rightarrow P = \$90.48</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mop >ln</span><span class=mopen >(</span><span class=mord >100</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.6444em;"></span><span class=mord >0.10</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.6444em;"></span><span class=mord >4.505</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >⇒</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.8056em;vertical-align:-0.0556em;"></span><span class=mord >$90.48</span></span></span></span></p> </ul> <p>Now risk/reward is truly balanced in log space.</p> <h2 id=julia_implementation ><a href="#julia_implementation" class=header-anchor >Julia Implementation</a></h2> <h3 id=estimating_ou_process_parameters ><a href="#estimating_ou_process_parameters" class=header-anchor >Estimating OU Process Parameters</a></h3> <pre><code class=language-julia >using Statistics, LinearAlgebra

function estimate_ou_parameters&#40;log_prices::Vector&#123;Float64&#125;, Δt::Float64&#41;
    &quot;&quot;&quot;
    Estimate θ, μ, σ from historical log price data
    Using discrete-time regression: Δ&#40;log P&#41; &#61; θ&#40;μ - log P_t&#41;Δt &#43; ε
    &quot;&quot;&quot;
    n &#61; length&#40;log_prices&#41; - 1
    
    # Create regression variables
    X &#61; hcat&#40;ones&#40;n&#41;, log_prices&#91;1:end-1&#93;&#41;  # &#91;1, log P_t&#93;
    y &#61; diff&#40;log_prices&#41;  # Δ&#40;log P&#41;
    
    # OLS regression: y &#61; β₀ &#43; β₁*log_P_t &#43; ε
    β &#61; &#40;X&#39; * X&#41; \ &#40;X&#39; * y&#41;
    
    # Extract parameters
    # y &#61; θμΔt - θΔt*log_P_t &#43; ε
    θ &#61; -β&#91;2&#93; / Δt
    μ &#61; -β&#91;1&#93; / β&#91;2&#93;
    
    # Estimate volatility from residuals
    residuals &#61; y - X * β
    σ &#61; std&#40;residuals&#41; / sqrt&#40;Δt&#41;
    
    return θ, μ, σ
end

# Example usage
log_prices &#61; &#91;4.60, 4.58, 4.56, 4.55, 4.54, 4.53, 4.52, 4.50&#93;
Δt &#61; 1/60  # 1 minute intervals

θ, μ, σ &#61; estimate_ou_parameters&#40;log_prices, Δt&#41;
println&#40;&quot;θ &#40;reversion speed&#41;: &#36;&#40;round&#40;θ, digits&#61;3&#41;&#41;&quot;&#41;
println&#40;&quot;μ &#40;long-run mean&#41;: &#36;&#40;round&#40;μ, digits&#61;3&#41;&#41;&quot;&#41;
println&#40;&quot;σ &#40;volatility&#41;: &#36;&#40;round&#40;σ, digits&#61;3&#41;&#41;&quot;&#41;</code></pre> <h3 id=optimal_stopping_decision ><a href="#optimal_stopping_decision" class=header-anchor >Optimal Stopping Decision</a></h3> <pre><code class=language-julia >function expected_log_price&#40;log_P_current::Float64, θ::Float64, 
                           μ::Float64, Δt::Float64&#41;
    &quot;&quot;&quot;
    Expected log price after Δt under OU process
    E&#91;ln P_&#123;t&#43;Δt&#125; | ln P_t&#93; &#61; ln P_t &#43; θ&#40;μ - ln P_t&#41;Δt
    &quot;&quot;&quot;
    return log_P_current &#43; θ * &#40;μ - log_P_current&#41; * Δt
end

function should_exit&#40;log_entry::Float64, log_current::Float64, 
                    θ::Float64, μ::Float64, Δt::Float64, 
                    holding_cost::Float64&#41;
    &quot;&quot;&quot;
    Optimal stopping decision in log space
    Exit if current profit ≥ expected future profit - costs
    &quot;&quot;&quot;
    # Current profit in log space
    current_profit &#61; log_current - log_entry
    
    # Expected log price after Δt
    log_expected &#61; expected_log_price&#40;log_current, θ, μ, Δt&#41;
    expected_profit &#61; log_expected - log_entry
    
    # Exit if holding is not worth the cost
    return current_profit &gt;&#61; expected_profit - holding_cost
end

# Example: Decision at different price levels
log_entry &#61; 4.50  # Entered at &#36;90
θ, μ &#61; 2.0, 4.605
Δt &#61; 0.1  # 6 minutes
holding_cost &#61; 0.001  # 0.1&#37; cost

for log_P in 4.52:0.01:4.62
    P &#61; exp&#40;log_P&#41;
    exit_decision &#61; should_exit&#40;log_entry, log_P, θ, μ, Δt, holding_cost&#41;
    profit_pct &#61; 100 * &#40;log_P - log_entry&#41;
    
    println&#40;&quot;Price: \&#36;&#36;&#40;round&#40;P, digits&#61;2&#41;&#41;, &quot; *
            &quot;Profit: &#36;&#40;round&#40;profit_pct, digits&#61;2&#41;&#41;&#37;, &quot; *
            &quot;Exit: &#36;exit_decision&quot;&#41;
end</code></pre> <h3 id=monte_carlo_simulation ><a href="#monte_carlo_simulation" class=header-anchor >Monte Carlo Simulation</a></h3> <pre><code class=language-julia >using Random, Distributions

function simulate_ou_path&#40;log_P0::Float64, θ::Float64, μ::Float64, 
                         σ::Float64, Δt::Float64, n_steps::Int&#41;
    &quot;&quot;&quot;
    Simulate one path of OU process in log space
    &quot;&quot;&quot;
    log_prices &#61; zeros&#40;n_steps &#43; 1&#41;
    log_prices&#91;1&#93; &#61; log_P0
    
    for t in 1:n_steps
        drift &#61; θ * &#40;μ - log_prices&#91;t&#93;&#41; * Δt
        diffusion &#61; σ * sqrt&#40;Δt&#41; * randn&#40;&#41;
        log_prices&#91;t&#43;1&#93; &#61; log_prices&#91;t&#93; &#43; drift &#43; diffusion
    end
    
    return log_prices
end

function test_exit_strategies&#40;log_entry::Float64, θ::Float64, μ::Float64,
                             σ::Float64, Δt::Float64, n_sims::Int&#41;
    &quot;&quot;&quot;
    Compare different exit strategies via Monte Carlo
    &quot;&quot;&quot;
    n_steps &#61; 100  # Simulate 100 time steps
    
    # Strategy results
    single_exit_profits &#61; Float64&#91;&#93;
    scaled_exit_profits &#61; Float64&#91;&#93;
    optimal_stop_profits &#61; Float64&#91;&#93;
    
    for sim in 1:n_sims
        log_path &#61; simulate_ou_path&#40;log_entry, θ, μ, σ, Δt, n_steps&#41;
        
        # Strategy 1: Single exit at &#43;2&#37; or -1&#37; stop
        target &#61; log_entry &#43; 0.02
        stop &#61; log_entry - 0.01
        single_profit &#61; 0.0
        
        for log_P in log_path
            if log_P &gt;&#61; target
                single_profit &#61; 0.02
                break
            elseif log_P &lt;&#61; stop
                single_profit &#61; -0.01
                break
            end
        end
        push&#33;&#40;single_exit_profits, single_profit&#41;
        
        # Strategy 2: Scaled exit &#40;1/3 at 0.5&#37;, 1&#37;, 1.5&#37;&#41;
        targets &#61; &#91;log_entry &#43; 0.005, log_entry &#43; 0.01, log_entry &#43; 0.015&#93;
        filled &#61; &#91;false, false, false&#93;
        scaled_profit &#61; 0.0
        
        for log_P in log_path
            for i in 1:3
                if &#33;filled&#91;i&#93; &amp;&amp; log_P &gt;&#61; targets&#91;i&#93;
                    filled&#91;i&#93; &#61; true
                    scaled_profit &#43;&#61; &#40;targets&#91;i&#93; - log_entry&#41; / 3
                end
            end
            if all&#40;filled&#41;
                break
            end
        end
        push&#33;&#40;scaled_exit_profits, scaled_profit&#41;
        
        # Strategy 3: Optimal stopping
        optimal_profit &#61; 0.0
        for &#40;i, log_P&#41; in enumerate&#40;log_path&#41;
            if should_exit&#40;log_entry, log_P, θ, μ, Δt, 0.0001&#41;
                optimal_profit &#61; log_P - log_entry
                break
            end
        end
        push&#33;&#40;optimal_stop_profits, optimal_profit&#41;
    end
    
    # Calculate statistics
    strategies &#61; &#91;&quot;Single Exit&quot;, &quot;Scaled Exit&quot;, &quot;Optimal Stop&quot;&#93;
    results &#61; &#91;single_exit_profits, scaled_exit_profits, optimal_stop_profits&#93;
    
    println&#40;&quot;\nMonte Carlo Results &#40;&#36;n_sims simulations&#41;:\n&quot;&#41;
    println&#40;&quot;Strategy          | Mean    | Std Dev | Sharpe&quot;&#41;
    println&#40;&quot;-&quot; ^ 50&#41;
    
    for &#40;name, profits&#41; in zip&#40;strategies, results&#41;
        μ_profit &#61; mean&#40;profits&#41;
        σ_profit &#61; std&#40;profits&#41;
        sharpe &#61; μ_profit / σ_profit
        
        println&#40;&quot;&#36;&#40;rpad&#40;name, 17&#41;&#41; | &quot; *
                &quot;&#36;&#40;rpad&#40;round&#40;100*μ_profit, digits&#61;3&#41;, 7&#41;&#41; | &quot; *
                &quot;&#36;&#40;rpad&#40;round&#40;100*σ_profit, digits&#61;3&#41;, 7&#41;&#41; | &quot; *
                &quot;&#36;&#40;round&#40;sharpe, digits&#61;3&#41;&#41;&quot;&#41;
    end
end

# Run simulation
Random.seed&#33;&#40;42&#41;
test_exit_strategies&#40;4.50, 2.0, 4.605, 0.15, 0.1, 10000&#41;</code></pre> <h2 id=key_insights_from_log_space_analysis ><a href="#key_insights_from_log_space_analysis" class=header-anchor >Key Insights from Log Space Analysis</a></h2> <h3 id=probabilities_are_more_stable ><a href="#probabilities_are_more_stable" class=header-anchor ><ol> <li><p>Probabilities are More Stable</p> </ol> </a></h3> <p>In price space, the probability of reaching &#36;110 from &#36;100 is different from reaching &#36;55 from &#36;50.</p> <p>In log space, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy=false >(</mo><mtext>reach </mtext><mo>+</mo><mn>0.0953</mn><mo>∣</mo><mtext>entry</mtext><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">P(\text{reach } +0.0953 \mid \text{entry})</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord text"><span class=mord >reach </span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord >0.0953</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class=mord >entry</span></span><span class=mclose >)</span></span></span></span> is the same regardless of price level&#33;</p> <h3 id=ol_start2_variance_reduction_still_dominates ><a href="#ol_start2_variance_reduction_still_dominates" class=header-anchor ><ol start=2 > <li><p>Variance Reduction Still Dominates</p> </ol> </a></h3> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mtext>Var</mtext><mrow><mo fence=true >[</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mn>3</mn></munderover><mfrac><mn>1</mn><mn>3</mn></mfrac><mo stretchy=false >(</mo><mi>ln</mi><mo>⁡</mo><msub><mi>P</mi><msub><mi>T</mi><mi>i</mi></msub></msub><mo>−</mo><mi>ln</mi><mo>⁡</mo><msub><mi>P</mi><mn>0</mn></msub><mo stretchy=false >)</mo><mo fence=true >]</mo></mrow><mo>&lt;</mo><mtext>Var</mtext><mo stretchy=false >[</mo><mi>ln</mi><mo>⁡</mo><msub><mi>P</mi><msub><mi>T</mi><mn>3</mn></msub></msub><mo>−</mo><mi>ln</mi><mo>⁡</mo><msub><mi>P</mi><mn>0</mn></msub><mo stretchy=false >]</mo></mrow><annotation encoding="application/x-tex">\text{Var}\left[\sum_{i=1}^{3} \frac{1}{3}(\ln P_{T_i} - \ln P_0)\right] &lt; \text{Var}[\ln P_{T_3} - \ln P_0]</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:3.0788em;vertical-align:-1.2777em;"></span><span class="mord text"><span class=mord >Var</span></span><span class=mspace  style="margin-right:0.1667em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">[</span></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.8011em;"><span style="top:-1.8723em;margin-left:0em;"><span class=pstrut  style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class=pstrut  style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class=pstrut  style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.2777em;"><span></span></span></span></span></span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.3214em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >3</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mopen >(</span><span class=mop >ln</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.1389em;margin-right:0.0714em;"><span class=pstrut  style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2501em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mop >ln</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">]</span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >&lt;</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1.0001em;vertical-align:-0.2501em;"></span><span class="mord text"><span class=mord >Var</span></span><span class=mopen >[</span><span class=mop >ln</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.1389em;margin-right:0.0714em;"><span class=pstrut  style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">3</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2501em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mop >ln</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >]</span></span></span></span></span> <p>Scaled exits reduce variance in log space, which compounds to better long-term growth.</p> <h3 id=ol_start3_kelly_criterion_connection ><a href="#ol_start3_kelly_criterion_connection" class=header-anchor ><ol start=3 > <li><p>Kelly Criterion Connection</p> </ol> </a></h3> <p>Since log returns compound multiplicatively, Kelly criterion naturally works in log space:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><munder><mrow><mi>max</mi><mo>⁡</mo></mrow><mi>f</mi></munder><mi>E</mi><mo stretchy=false >[</mo><mi>ln</mi><mo>⁡</mo><mo stretchy=false >(</mo><mtext>Wealth</mtext><mo stretchy=false >)</mo><mo stretchy=false >]</mo></mrow><annotation encoding="application/x-tex">\max_f E[\ln(\text{Wealth})]</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.6382em;vertical-align:-0.8882em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.4306em;"><span style="top:-2.3479em;margin-left:0em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span><span class=mop >max</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.8882em;"><span></span></span></span></span></span><span class=mspace  style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=mopen >[</span><span class=mop >ln</span><span class=mopen >(</span><span class="mord text"><span class=mord >Wealth</span></span><span class=mclose >)]</span></span></span></span></span> <p>This reinforces: work in log space for all decision-making&#33;</p> <h2 id=bottom_line ><a href="#bottom_line" class=header-anchor >Bottom Line</a></h2> <p><strong>Optimal stopping MUST use log prices</strong> because:</p> <ol> <li><p>✓ Normalizes for price level</p> <li><p>✓ Makes mean reversion linear and tractable</p> <li><p>✓ Creates stable, stationary probabilities</p> <li><p>✓ Aligns with Kelly criterion &#40;log wealth maximization&#41;</p> <li><p>✓ Enables proper risk-symmetric stop/target placement</p> </ol> <p><strong>And scaled exits still win</strong> because variance reduction in log space leads to superior compounding over time&#33;</p> <div class=page-foot > Contact me by <a href="mailto:skchu@wustl.edu">E-mail</a> | <a href="https://github.com/kchu25">Github</a> | <a href="https://www.linkedin.com/in/kchu1/">Linkedin</a> <br> This work is licensed under <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>. Last modified: October 20, 2025. <br> Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia language</a>. </div> </div> <script src="/finance/libs/highlight/highlight.min.js"></script> <script>hljs.highlightAll();hljs.configure({tabReplace: ' '});</script>